!function(){if("navigate"in window)return;const t={37:"left",38:"up",39:"right",40:"down"};let e=null,n=null,o={element:null,rect:null},i=null;function r(t){const e=function(){let t=document.activeElement;if(!t||t===document.body&&!document.querySelector(":focus")){if(o.element&&t!==o.element){const e=window.getComputedStyle(o.element,null),n=["hidden","collapse"];if(o.element.disabled||n.includes(e.getPropertyValue("visibility")))return t=o.element,t}t=document.documentElement}if(!o.element||0!==V(o.element).height&&0!==V(o.element).width||(i=o.rect),!S(t)){const e=m(t);if(e&&(e===window||"auto"===h(e)))return e}return t}();let r=e,u=null;n&&(u=document.elementFromPoint(n.x,n.y),null===u&&(u=document.body),C(u)&&!y(u)?n=null:r=y(u)?u:u.getSpatialNavigationContainer()),r!==document&&r!==document.documentElement||(r=document.body||document.documentElement);let s=null;if((y(r)||"BODY"===r.nodeName)&&"INPUT"!==r.nodeName){"IFRAME"===r.nodeName&&(r=r.contentDocument.documentElement),s=r;let n=null;if(document.activeElement===e||document.activeElement===document.body&&e===document.documentElement){if("scroll"===h(r)){if(l(r,t))return}else if("focus"===h(r)){if(n=r.spatialNavigationSearch(t,{container:r,candidates:c(r,{mode:"all"})}),a(n,t))return}else if("auto"===h(r)&&(n=r.spatialNavigationSearch(t,{container:r}),a(n,t)||l(r,t)))return}else s=s.getSpatialNavigationContainer()}s=r.getSpatialNavigationContainer();let d=s.parentElement?s.getSpatialNavigationContainer():null;if(d||window.location===window.parent.location||(d=window.parent.document.documentElement),"scroll"===h(s)){if(l(s,t))return}else"focus"===h(s)?w(r,s,d,t,"all"):"auto"===h(s)&&w(r,s,d,t,"visible")}function a(t,e){if(t){if(!p("beforefocus",t,null,e))return!0;const o=t.getSpatialNavigationContainer();return o!==window&&"focus"===h(o)?t.focus():t.focus({preventScroll:!0}),n=null,!0}return!1}function l(t,e){return x(t,e)&&!I(t,e)?(v(t,e),!0):!t.parentElement&&!N(t,e)&&(v(t.ownerDocument.documentElement,e),!0)}function c(t,e={mode:"visible"}){let n=[];if(t.childElementCount>0){t.parentElement||(t=t.getElementsByTagName("body")[0]||document.body);const e=t.children;for(const t of e)b(t)?n.push(t):C(t)?(n.push(t),!y(t)&&t.childElementCount&&(n=n.concat(c(t,{mode:"all"})))):t.childElementCount&&(n=n.concat(c(t,{mode:"all"})))}return"all"===e.mode?n:n.filter(k)}function u(t,e,n,o){const i=t;return o=o||i.getSpatialNavigationContainer(),s(i,n=!n||n.length<=0?c(o):n,e,o)}function s(t,e,n,o){const r=t.getSpatialNavigationContainer();let a;return void 0===n?e:(a=r.parentElement&&o!==r&&!k(t)?V(r):i||V(t),!y(t)&&"BODY"!==t.nodeName||"INPUT"===t.nodeName?e.filter(e=>{const i=V(e),r="IFRAME"===e.nodeName?e.contentDocument.body:null;return o.contains(e)&&e!==t&&r!==t&&A(i,a,n)&&!M(a,i)}):e.filter(e=>{const i=V(e);return o.contains(e)&&(t.contains(e)&&M(a,i)&&e!==t||A(i,a,n))}))}function d(t,e,n){const o=t.getSpatialNavigationContainer(),r=getComputedStyle(o).getPropertyValue("--spatial-navigation-function"),a=i||V(t);let l,c;switch(r){case"grid":c=e.filter(t=>F(a,V(t),n)),c.length>0&&(e=c),l=W;break;default:l=H}return f(t,e,n,l)}function f(t,e,n,o){let r=null;window.location===window.parent.location||"BODY"!==t.nodeName&&"HTML"!==t.nodeName?r=i||t.getBoundingClientRect():(r=window.frameElement.getBoundingClientRect(),r.x=0,r.y=0);let a=Number.POSITIVE_INFINITY,l=[];if(e)for(let i=0;i<e.length;i++){const t=o(r,V(e[i]),n);t<a?(a=t,l=[e[i]]):t===a&&l.push(e[i])}return 0===l.length?null:l.length>1&&o===W?f(t,l,n,D):l[0]}function m(t){let e=t;do{if(!e.parentElement){e=window.location!==window.parent.location?window.parent.document.documentElement:window.document.documentElement;break}e=e.parentElement}while(!E(e)||!k(e));return e!==document&&e!==document.documentElement||(e=window),e}function p(t,e,n,o){if(["beforefocus","notarget"].includes(t)){const i=new CustomEvent("nav"+t,{bubbles:!0,cancelable:!0,detail:{causedTarget:n,dir:o}});return e.dispatchEvent(i)}}function g(t,e){return t.style.getPropertyValue("--"+e).trim()}function h(t){return g(t,"spatial-navigation-action")||"auto"}function w(t,e,n,o,i){let r={candidates:c(e,{mode:i}),container:e};for(;n;){if(a(t.spatialNavigationSearch(o,r),o))return;if("visible"===i&&l(e,o))return;{if(!p("notarget",e,t,o))return;e===document||e===document.documentElement?window.location!==window.parent.location&&(e=(t=window.frameElement).ownerDocument.documentElement):e=n,r={candidates:c(e,{mode:i}),container:e};let a=e.getSpatialNavigationContainer();n=a!==e?a:null}}r={candidates:c(e,{mode:i}),container:e},!n&&e&&a(t.spatialNavigationSearch(o,r),o)||p("notarget",r.container,t,o)&&("auto"!==h(e)||"visible"!==i||l(e,o))}function v(t,e,n=0){if(t)switch(e){case"left":t.scrollLeft-=40+n;break;case"right":t.scrollLeft+=40+n;break;case"up":t.scrollTop-=40+n;break;case"down":t.scrollTop+=40+n}}function y(t){return!t.parentElement||"IFRAME"===t.nodeName||E(t)||function(t){return"contain"===g(t,"spatial-navigation-contain")}(t)}function b(t){return"delegable"===g(t,"spatial-navigation-contain")}function E(t){const e=window.getComputedStyle(t,null),n=e.getPropertyValue("overflow-x"),o=e.getPropertyValue("overflow-y");return!!("visible"!==n&&"clip"!==n&&P(t,"left")||"visible"!==o&&"clip"!==o&&P(t,"down"))}function x(t,e){if(t&&"object"==typeof t){if(e&&"string"==typeof e){if(P(t,e)){const n=window.getComputedStyle(t,null),o=n.getPropertyValue("overflow-x"),i=n.getPropertyValue("overflow-y");switch(e){case"left":case"right":return"visible"!==o&&"clip"!==o&&"hidden"!==o;case"up":case"down":return"visible"!==i&&"clip"!==i&&"hidden"!==i}}return!1}return"HTML"===t.nodeName||"BODY"===t.nodeName||E(t)&&P(t)}}function P(t,e){if(t&&"object"==typeof t){if(!e||"string"!=typeof e)return t.scrollWidth>t.clientWidth||t.scrollHeight>t.clientHeight;switch(e){case"left":case"right":return t.scrollWidth>t.clientWidth;case"up":case"down":return t.scrollHeight>t.clientHeight}return!1}}function N(t,e){let n=!1;switch(e){case"left":n=0===t.scrollLeft;break;case"right":n=t.scrollWidth-t.scrollLeft-t.clientWidth==0;break;case"up":n=0===t.scrollTop;break;case"down":n=t.scrollHeight-t.scrollTop-t.clientHeight==0}return n}function I(t,e){if(x(t,e)){const n=t.scrollTop,o=t.scrollLeft,i=t.scrollHeight-t.clientHeight,r=t.scrollWidth-t.clientWidth;switch(e){case"left":return 0===o;case"right":return Math.abs(o-r)<=1;case"up":return 0===n;case"down":return Math.abs(n-i)<=1}}return!1}function S(t){const e=t.getBoundingClientRect();let n=m(t),o=null;return o=n!==window?V(n):new DOMRect(0,0,window.innerWidth,window.innerHeight),!(!M(o,e)||!M(o,e))}function C(t){return!(t.tabIndex<0||function(t){return"A"===t.tagName&&null===t.getAttribute("href")&&null===t.getAttribute("tabIndex")}(t)||function(t){return!!["BUTTON","INPUT","SELECT","TEXTAREA","OPTGROUP","OPTION","FIELDSET"].includes(t.tagName)&&t.disabled}(t)||function(t){return t.inert&&!t.ownerDocument.documentElement.inert}(t)||!function(t){return!!B(t.parentElement)&&!(!B(t)||"0"===t.style.opacity||"0px"===window.getComputedStyle(t).height||"0px"===window.getComputedStyle(t).width)}(t))&&(!!(!t.parentElement||x(t)&&P(t)||t.tabIndex>=0)||void 0)}function k(t){return!t.parentElement||B(t)&&function(t){const e=V(t);if("IFRAME"!==t.nodeName&&(e.top<0||e.left<0||e.top>t.ownerDocument.documentElement.clientHeight||e.left>t.ownerDocument.documentElement.clientWidth))return!1;let n=parseInt(t.offsetWidth)/10,o=parseInt(t.offsetHeight)/10;n=isNaN(n)?1:n,o=isNaN(o)?1:o;const i={middle:[(e.left+e.right)/2,(e.top+e.bottom)/2],leftTop:[e.left+n,e.top+o],rightBottom:[e.right-n,e.bottom-o]};for(const r in i){const e=t.ownerDocument.elementFromPoint(...i[r]);if(t===e||t.contains(e))return!0}return!1}(t)}function T(t,e){const n=V(t),o=V(e||t.getSpatialNavigationContainer());return!(n.left<o.left||n.right>o.right||n.top<o.top||n.bottom>o.bottom)}function B(t){const e=window.getComputedStyle(t,null),n=e.getPropertyValue("visibility");return"none"!==e.getPropertyValue("display")&&!["hidden","collapse"].includes(n)}function M(t,e){return(t.left<=e.right&&t.right>=e.right||t.left<=e.left&&t.right>=e.left)&&(t.top<=e.top&&t.bottom>=e.top||t.top<=e.bottom&&t.bottom>=e.bottom)}function A(t,e,n){switch(n){case"left":return O(e,t);case"right":return O(t,e);case"up":return L(e,t);case"down":return L(t,e);default:return!1}}function O(t,e){return t.left>=e.right||t.left>=e.left&&t.right>e.right&&t.bottom>e.top&&t.top<e.bottom}function L(t,e){return t.top>=e.bottom||t.top>=e.top&&t.bottom>e.bottom&&t.left<e.right&&t.right>e.left}function F(t,e,n){switch(n){case"left":case"right":return t.bottom>e.top&&t.top<e.bottom;case"up":case"down":return t.right>e.left&&t.left<e.right;default:return!1}}function _(t,e,o){const i=j(o,n,e),r=Math.abs(i.entryPoint.x-i.exitPoint.x),a=Math.abs(i.entryPoint.y-i.exitPoint.y);return Math.sqrt(Math.pow(r,2)+Math.pow(a,2))}function R(t,e,n){const o={left:"right",right:"left",up:"bottom",down:"top"}[n];return Math.abs(t[o]-e[o])}function H(t,e,n){let o=0,i=0;const r=j(n,t,e),a=Math.abs(r.entryPoint.x-r.exitPoint.x),l=Math.abs(r.entryPoint.y-r.exitPoint.y),c=Math.sqrt(Math.pow(a,2)+Math.pow(l,2));let u,s;const d=function(t,e){const n={width:0,height:0,area:0},o=[Math.max(t.left,e.left),Math.max(t.top,e.top)],i=[Math.min(t.right,e.right),Math.min(t.bottom,e.bottom)];return n.width=Math.abs(o[0]-i[0]),n.height=Math.abs(o[1]-i[1]),o[0]>=i[0]||o[1]>=i[1]||(n.area=Math.sqrt(n.width*n.height)),n}(t,e),f=d.area;switch(n){case"left":case"right":F(t,e,n)?i=Math.min(d.height/t.height,1):o=t.height/2,u=30*(l+o),s=5*i;break;case"up":case"down":F(t,e,n)?i=Math.min(d.width/t.width,1):o=t.width/2,u=2*(a+o),s=5*i;break;default:u=0,s=0}return c+u-s-f}function D(t,e,n){const o=j(n,t,e),i=Math.abs(o.entryPoint.x-o.exitPoint.x),r=Math.abs(o.entryPoint.y-o.exitPoint.y);return Math.sqrt(Math.pow(i,2)+Math.pow(r,2))}function W(t,e,n){const o=j(n,t,e);return"left"===n||"right"===n?Math.abs(o.entryPoint.x-o.exitPoint.x):Math.abs(o.entryPoint.y-o.exitPoint.y)}function j(t="down",e,o){const i={entryPoint:{x:0,y:0},exitPoint:{x:0,y:0}};if(n){switch(i.exitPoint=e,t){case"left":i.entryPoint.x=o.right;break;case"up":i.entryPoint.y=o.bottom;break;case"right":i.entryPoint.x=o.left;break;case"down":i.entryPoint.y=o.top}switch(t){case"left":case"right":i.entryPoint.y=n.y<=o.top?o.top:n.y<o.bottom?n.y:o.bottom;break;case"up":case"down":i.entryPoint.x=n.x<=o.left?o.left:n.x<o.right?n.x:o.right}}else{switch(t){case"left":i.exitPoint.x=e.left,i.entryPoint.x=o.right<e.left?o.right:e.left;break;case"up":i.exitPoint.y=e.top,i.entryPoint.y=o.bottom<e.top?o.bottom:e.top;break;case"right":i.exitPoint.x=e.right,i.entryPoint.x=o.left>e.right?o.left:e.right;break;case"down":i.exitPoint.y=e.bottom,i.entryPoint.y=o.top>e.bottom?o.top:e.bottom}switch(t){case"left":case"right":L(e,o)?(i.exitPoint.y=e.top,i.entryPoint.y=o.bottom<e.top?o.bottom:e.top):L(o,e)?(i.exitPoint.y=e.bottom,i.entryPoint.y=o.top>e.bottom?o.top:e.bottom):(i.exitPoint.y=Math.max(e.top,o.top),i.entryPoint.y=i.exitPoint.y);break;case"up":case"down":O(e,o)?(i.exitPoint.x=e.left,i.entryPoint.x=o.right<e.left?o.right:e.left):O(o,e)?(i.exitPoint.x=e.right,i.entryPoint.x=o.left>e.right?o.left:e.right):(i.exitPoint.x=Math.max(e.left,o.left),i.entryPoint.x=i.exitPoint.x)}}return i}function V(t){let n=e&&e.get(t);if(!n){const o=t.getBoundingClientRect();n={top:Number(o.top.toFixed(2)),right:Number(o.right.toFixed(2)),bottom:Number(o.bottom.toFixed(2)),left:Number(o.left.toFixed(2)),width:Number(o.width.toFixed(2)),height:Number(o.height.toFixed(2))},e&&e.set(t,n)}return n}function K(t){const e=window.__spatialNavigation__&&window.__spatialNavigation__.keyMode;window.__spatialNavigation__=!1===t?U():Object.assign(U(),function(){function t(t,e){return x(t,e)&&!I(t,e)||!t.parentElement&&!N(t,e)}function e(e,n,o,i){let r=n,a=null;if(r!==document&&r!==document.documentElement||(r=document.body||document.documentElement),(y(r)||"BODY"===r.nodeName)&&"INPUT"!==r.nodeName){"IFRAME"===r.nodeName&&(r=r.contentDocument.body);const n=c(r,i);if(Array.isArray(n)&&n.length>0)return e?u(r,o,n):r.spatialNavigationSearch(o,{candidates:n});if(t(r,o))return e?[]:r}let l=r.getSpatialNavigationContainer(),d=l.parentElement?l.getSpatialNavigationContainer():null;for(d||window.location===window.parent.location||(d=window.parent.document.documentElement);d;){const n=s(r,c(l,i),o,l);if(Array.isArray(n)&&n.length>0){if(a=r.spatialNavigationSearch(o,{candidates:n,container:l}),a)return e?n:a}else{if(t(l,o))return e?[]:r;if(l===document||l===document.documentElement){if(l=window.document.documentElement,window.location!==window.parent.location){if(r=window.frameElement,l=window.parent.document.documentElement,!l.parentElement){d=null;break}d=l.getSpatialNavigationContainer()}}else{if(C(l)&&(r=l),l=d,!l.parentElement){d=null;break}d=l.getSpatialNavigationContainer()}}}if(!d&&l){const t=s(r,c(l,i),o,l);if(Array.isArray(t)&&t.length>0&&(a=r.spatialNavigationSearch(o,{candidates:t,container:l}),a))return e?t:a}if(t(l,o))return a=r,a}return{isContainer:y,isScrollContainer:E,isVisibleInScroller:S,findCandidates:e.bind(null,!0),findNextTarget:e.bind(null,!1),getDistanceFromTarget:(t,e,n)=>(y(t)||"BODY"===t.nodeName)&&"INPUT"!==t.nodeName&&c(t).includes(e)?R(V(t),V(e),n):H(V(t),V(e),n)}}()),window.__spatialNavigation__.keyMode=e,Object.seal(window.__spatialNavigation__)}function U(){return{enableExperimentalAPIs:K,get keyMode(){return this._keymode?this._keymode:"ARROW"},set keyMode(t){this._keymode=["SHIFTARROW","ARROW","NONE"].includes(t)?t:"ARROW"},setStartingPoint:function(t,e){n=t&&e?{x:t,y:e}:null}}}window.navigate=r,window.Element.prototype.spatialNavigationSearch=function(t,e){const o=this;let r,a=[],l=[],s=function(t){const e=t.getSpatialNavigationContainer().focusableAreas(),n=[];return e.forEach(e=>{t!==e&&T(e,t)&&n.push(e)}),n}(o);e||(e={});const m=o.getSpatialNavigationContainer();let p=c(m);const g=e.container||m;e.container&&m.contains(e.container)&&(p=p.concat(c(g)));const h=e.candidates&&e.candidates.length>0?e.candidates.filter(t=>g.contains(t)):p.filter(t=>g.contains(t)&&g!==t);if(h&&h.length>0){h.forEach(t=>{t!==o&&(o.contains(t)&&o!==t?a:l).push(t)});let e=s.filter(t=>!a.includes(t)),m=h.filter(t=>y(t)&&T(o,t)).map(t=>t.focusableAreas()).flat().filter(t=>t!==o);if(a=a.concat(e).filter(t=>g.contains(t)),l=l.concat(m).filter(t=>g.contains(t)),l.length>0&&(l=u(o,t,l,g)),i&&(r=d(o,u(o,t,a,g),t)),a&&a.length>0&&"INPUT"!==o.nodeName&&(r=function(t,e,o){return f(t,e,o,n?_:R)}(o,a,t)),r=r||d(o,l,t),r&&b(r)){const e=c(r,{mode:"all"}),n=e.length>0?o.spatialNavigationSearch(t,{candidates:e,container:r}):null;n?r=n:C(r)||(h.splice(h.indexOf(r),1),r=h.length?o.spatialNavigationSearch(t,{candidates:h,container:g}):null)}return r}return null},window.Element.prototype.focusableAreas=function(t={mode:"visible"}){const e=this.parentElement?this:document.body,n=Array.prototype.filter.call(e.getElementsByTagName("*"),C);return"all"===t.mode?n:n.filter(k)},window.Element.prototype.getSpatialNavigationContainer=function(){let t=this;do{if(!t.parentElement){t=window.location!==window.parent.location?window.parent.document.documentElement:window.document.documentElement;break}t=t.parentElement}while(!y(t));return t},window.CSS&&CSS.registerProperty&&(""===window.getComputedStyle(document.documentElement).getPropertyValue("--spatial-navigation-contain")&&CSS.registerProperty({name:"--spatial-navigation-contain",syntax:"auto | contain",inherits:!1,initialValue:"auto"}),""===window.getComputedStyle(document.documentElement).getPropertyValue("--spatial-navigation-action")&&CSS.registerProperty({name:"--spatial-navigation-action",syntax:"auto | focus | scroll",inherits:!1,initialValue:"auto"}),""===window.getComputedStyle(document.documentElement).getPropertyValue("--spatial-navigation-function")&&CSS.registerProperty({name:"--spatial-navigation-function",syntax:"normal | grid",inherits:!1,initialValue:"normal"})),K(!1),window.addEventListener("load",()=>{window.addEventListener("keydown",o=>{const i=parent&&parent.__spatialNavigation__.keyMode||window.__spatialNavigation__.keyMode,a=document.activeElement,l=t[o.keyCode];if(9===o.keyCode&&(n=null),!(!i||"NONE"===i||"SHIFTARROW"===i&&!o.shiftKey||"ARROW"===i&&o.shiftKey||o.defaultPrevented)){let i={left:!0,up:!0,right:!0,down:!0};"INPUT"!==a.nodeName&&"TEXTAREA"!==a.nodeName||(i=function(e){const n=document.activeElement,o=n.selectionStart,i=n.selectionEnd,r={left:!1,up:!1,right:!1,down:!1},a=t[e.keyCode];return void 0===a||(["email","date","month","number","time","week"].includes(n.getAttribute("type"))&&("up"===a||"down"===a)||!["password","text","search","tel","url",null].includes(n.getAttribute("type"))&&"TEXTAREA"!==n.nodeName?r[a]=!0:o===i&&(0===o&&(r.left=!0,r.up=!0),i===n.value.length&&(r.right=!0,r.down=!0))),r}(o)),i[l]&&(o.preventDefault(),e=new Map,r(l),e=null,n=null)}}),document.addEventListener("mouseup",t=>{n={x:t.clientX,y:t.clientY}}),window.addEventListener("focusin",t=>{t.target!==window&&(o.element=t.target,o.rect=t.target.getBoundingClientRect())})})}(),function(t){"use strict";var e={selector:"",straightOnly:!1,straightOverlapThreshold:.5,rememberSource:!1,disabled:!1,defaultElement:"",enterTo:"",leaveFor:null,restrict:"self-first",tabIndexIgnoreList:"a, input, select, textarea, button, iframe, [contentEditable=true]",navigableFilter:null},n={37:"left",38:"up",39:"right",40:"down"},o={left:"right",up:"down",right:"left",down:"up"},i=0,r=!1,a=!1,l={},c=0,u="",s="",d=!1,f=Element.prototype.matches||Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||function(t){var e=(this.parentNode||this.document).querySelectorAll(t);return[].slice.call(e).indexOf(this)>=0};function m(t){var e=t.getBoundingClientRect(),n={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height};return n.element=t,n.center={x:n.left+Math.floor(n.width/2),y:n.top+Math.floor(n.height/2)},n.center.left=n.center.right=n.center.x,n.center.top=n.center.bottom=n.center.y,n}function p(t,e,n){for(var o=[[],[],[],[],[],[],[],[],[]],i=0;i<t.length;i++){var r,a=t[i],l=a.center;if(o[r=3*(l.y<e.top?0:l.y<=e.bottom?1:2)+(l.x<e.left?0:l.x<=e.right?1:2)].push(a),-1!==[0,2,6,8].indexOf(r)){var c=n;a.left<=e.right-e.width*c&&(2===r?o[1].push(a):8===r&&o[7].push(a)),a.right>=e.left+e.width*c&&(0===r?o[1].push(a):6===r&&o[7].push(a)),a.top<=e.bottom-e.height*c&&(6===r?o[3].push(a):8===r&&o[5].push(a)),a.bottom>=e.top+e.height*c&&(0===r?o[3].push(a):2===r&&o[5].push(a))}}return o}function g(t,e,n,o){if(!(t&&e&&n&&n.length))return null;for(var i=[],r=0;r<n.length;r++){var a=m(n[r]);a&&i.push(a)}if(!i.length)return null;var l=m(t);if(!l)return null;var c,u=function(t){return{nearPlumbLineIsBetter:function(e){var n;return(n=e.center.x<t.center.x?t.center.x-e.right:e.left-t.center.x)<0?0:n},nearHorizonIsBetter:function(e){var n;return(n=e.center.y<t.center.y?t.center.y-e.bottom:e.top-t.center.y)<0?0:n},nearTargetLeftIsBetter:function(e){var n;return(n=e.center.x<t.center.x?t.left-e.right:e.left-t.left)<0?0:n},nearTargetTopIsBetter:function(e){var n;return(n=e.center.y<t.center.y?t.top-e.bottom:e.top-t.top)<0?0:n},topIsBetter:function(t){return t.top},bottomIsBetter:function(t){return-1*t.bottom},leftIsBetter:function(t){return t.left},rightIsBetter:function(t){return-1*t.right}}}(l),s=p(i,l,o.straightOverlapThreshold),d=p(s[4],l.center,o.straightOverlapThreshold);switch(e){case"left":c=[{group:d[0].concat(d[3]).concat(d[6]),distance:[u.nearPlumbLineIsBetter,u.topIsBetter]},{group:s[3],distance:[u.nearPlumbLineIsBetter,u.topIsBetter]},{group:s[0].concat(s[6]),distance:[u.nearHorizonIsBetter,u.rightIsBetter,u.nearTargetTopIsBetter]}];break;case"right":c=[{group:d[2].concat(d[5]).concat(d[8]),distance:[u.nearPlumbLineIsBetter,u.topIsBetter]},{group:s[5],distance:[u.nearPlumbLineIsBetter,u.topIsBetter]},{group:s[2].concat(s[8]),distance:[u.nearHorizonIsBetter,u.leftIsBetter,u.nearTargetTopIsBetter]}];break;case"up":c=[{group:d[0].concat(d[1]).concat(d[2]),distance:[u.nearHorizonIsBetter,u.leftIsBetter]},{group:s[1],distance:[u.nearHorizonIsBetter,u.leftIsBetter]},{group:s[0].concat(s[2]),distance:[u.nearPlumbLineIsBetter,u.bottomIsBetter,u.nearTargetLeftIsBetter]}];break;case"down":c=[{group:d[6].concat(d[7]).concat(d[8]),distance:[u.nearHorizonIsBetter,u.leftIsBetter]},{group:s[7],distance:[u.nearHorizonIsBetter,u.leftIsBetter]},{group:s[6].concat(s[8]),distance:[u.nearPlumbLineIsBetter,u.topIsBetter,u.nearTargetLeftIsBetter]}];break;default:return null}o.straightOnly&&c.pop();var f=function(t){for(var e=null,n=0;n<t.length;n++)if(t[n].group.length){e=t[n];break}if(!e)return null;var o=e.distance;return e.group.sort(function(t,e){for(var n=0;n<o.length;n++){var i=o[n],r=i(t)-i(e);if(r)return r}return 0}),e.group}(c);if(!f)return null;var g=null;if(o.rememberSource&&o.previous&&o.previous.destination===t&&o.previous.reverse===e)for(var h=0;h<f.length;h++)if(f[h].element===o.previous.target){g=f[h].element;break}return g||(g=f[0].element),g}function h(){for(var t;t="section-"+String(++i),l[t];);return t}function w(e){return t?t(e).get():"string"==typeof e?[].slice.call(document.querySelectorAll(e)):"object"==typeof e&&e.length?[].slice.call(e):"object"==typeof e&&1===e.nodeType?[e]:[]}function v(e,n){return t?t(e).is(n):"string"==typeof n?f.call(e,n):"object"==typeof n&&n.length?n.indexOf(e)>=0:"object"==typeof n&&1===n.nodeType&&e===n}function y(){var t=document.activeElement;if(t&&t!==document.body)return t}function b(t){t=t||{};for(var e=1;e<arguments.length;e++)if(arguments[e])for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&void 0!==arguments[e][n]&&(t[n]=arguments[e][n]);return t}function E(t,e){Array.isArray(e)||(e=[e]);for(var n,o=0;o<e.length;o++)(n=t.indexOf(e[o]))>=0&&t.splice(n,1);return t}function x(t,n,o){if(!t||!n||!l[n]||l[n].disabled)return!1;if(t.offsetWidth<=0&&t.offsetHeight<=0||t.hasAttribute("disabled"))return!1;if(o&&!v(t,l[n].selector))return!1;if("function"==typeof l[n].navigableFilter){if(!1===l[n].navigableFilter(t,n))return!1}else if("function"==typeof e.navigableFilter&&!1===e.navigableFilter(t,n))return!1;return!0}function P(t){for(var e in l)if(!l[e].disabled&&v(t,l[e].selector))return e}function N(t){return w(l[t].selector).filter(function(e){return x(e,t)})}function I(e){var n=l[e].defaultElement;return n?("string"==typeof n?n=w(n)[0]:t&&n instanceof t&&(n=n.get(0)),x(n,e,!0)?n:null):null}function S(t){var e=l[t].lastFocusedElement;return x(e,t,!0)?e:null}function C(t,e,n,o){arguments.length<4&&(o=!0);var i=document.createEvent("CustomEvent");return i.initCustomEvent("sn:"+e,!0,o,n),t.dispatchEvent(i)}function k(t,e,n){if(!t)return!1;var o=y(),i=function(){o&&o.blur(),t.focus(),T(t,e)};if(d)return i(),!0;if(d=!0,a)return i(),d=!1,!0;if(o){var r={nextElement:t,nextSectionId:e,direction:n,native:!1};if(!C(o,"willunfocus",r))return d=!1,!1;o.blur(),C(o,"unfocused",r,!1)}var l={previousElement:o,sectionId:e,direction:n,native:!1};return C(t,"willfocus",l)?(t.focus(),C(t,"focused",l,!1),d=!1,T(t,e),!0):(d=!1,!1)}function T(t,e){e||(e=P(t)),e&&(l[e].lastFocusedElement=t,s=e)}function B(t,e){if("@"==t.charAt(0))return 1==t.length?M():M(t.substr(1));var n=w(t)[0];if(n){var o=P(n);if(x(n,o))return k(n,o,e)}return!1}function M(t){var e=[],n=function(t){t&&e.indexOf(t)<0&&l[t]&&!l[t].disabled&&e.push(t)};t?n(t):(n(u),n(s),Object.keys(l).map(n));for(var o=0;o<e.length;o++){var i,r=e[o];if(i="last-focused"==l[r].enterTo?S(r)||I(r)||N(r)[0]:I(r)||S(r)||N(r)[0])return k(i,r)}return!1}function A(t,e){C(t,"navigatefailed",{direction:e},!1)}function O(e,n){if(l[e].leaveFor&&void 0!==l[e].leaveFor[n]){var o=l[e].leaveFor[n];if("string"==typeof o)return""===o?null:B(o,n);t&&o instanceof t&&(o=o.get(0));var i=P(o);if(x(o,i))return k(o,i,n)}return!1}function L(t,n,i){var r=n.getAttribute("data-sn-"+t);if("string"==typeof r)return!(""===r||!B(r,t))||(A(n,t),!1);var a={},c=[];for(var u in l)a[u]=N(u),c=c.concat(a[u]);var s,d=b({},e,l[i]);if("self-only"==d.restrict||"self-first"==d.restrict){var f=a[i];(s=g(n,t,E(f,n),d))||"self-first"!=d.restrict||(s=g(n,t,E(c,f),d))}else s=g(n,t,E(c,n),d);if(s){l[i].previous={target:n,destination:s,reverse:o[t]};var m=P(s);if(i!=m){var p,h=O(i,t);if(h)return!0;if(null===h)return A(n,t),!1;switch(l[m].enterTo){case"last-focused":p=S(m)||I(m);break;case"default-element":p=I(m)}p&&(s=p)}return k(s,m,t)}return!!O(i,t)||(A(n,t),!1)}function F(t){if(!(!c||a||t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)){var e,o=function(){return t.preventDefault(),t.stopPropagation(),!1},i=n[t.keyCode];if(!i)return 13==t.keyCode&&(e=y())&&P(e)&&!C(e,"enter-down")?o():void 0;if(!(e=y())&&(s&&(e=S(s)),!e))return M(),o();var r=P(e);if(r)return C(e,"willmove",{direction:i,sectionId:r,cause:"keydown"})&&L(i,e,r),o()}}function _(t){if(!(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)&&!a&&c&&13==t.keyCode){var e=y();e&&P(e)&&(C(e,"enter-up")||(t.preventDefault(),t.stopPropagation()))}}function R(t){var e=t.target;if(e!==window&&e!==document&&c&&!d){var n=P(e);if(n){if(a)return void T(e,n);var o={sectionId:n,native:!0};C(e,"willfocus",o)?(C(e,"focused",o,!1),T(e,n)):(d=!0,e.blur(),d=!1)}}}function H(t){var e=t.target;if(e!==window&&e!==document&&!a&&c&&!d&&P(e)){var n={native:!0};C(e,"willunfocus",n)?C(e,"unfocused",n,!1):(d=!0,setTimeout(function(){e.focus(),d=!1}))}}var D={init:function(){r||(window.addEventListener("keydown",F),window.addEventListener("keyup",_),window.addEventListener("focus",R,!0),window.addEventListener("blur",H,!0),r=!0)},uninit:function(){window.removeEventListener("blur",H,!0),window.removeEventListener("focus",R,!0),window.removeEventListener("keyup",_),window.removeEventListener("keydown",F),D.clear(),i=0,r=!1},clear:function(){l={},c=0,u="",s="",d=!1},set:function(){var t,n;if("object"==typeof arguments[0])n=arguments[0];else{if("string"!=typeof arguments[0]||"object"!=typeof arguments[1])return;if(n=arguments[1],!l[t=arguments[0]])throw new Error('Section "'+t+"\" doesn't exist!")}for(var o in n)void 0!==e[o]&&(t?l[t][o]=n[o]:void 0!==n[o]&&(e[o]=n[o]));t&&(l[t]=b({},l[t]))},add:function(){var t,e={};if("object"==typeof arguments[0]?e=arguments[0]:"string"==typeof arguments[0]&&"object"==typeof arguments[1]&&(t=arguments[0],e=arguments[1]),t||(t="string"==typeof e.id?e.id:h()),l[t])throw new Error('Section "'+t+'" has already existed!');return l[t]={},c++,D.set(t,e),t},remove:function(t){if(!t||"string"!=typeof t)throw new Error('Please assign the "sectionId"!');return!!l[t]&&(l[t]=void 0,l=b({},l),c--,s===t&&(s=""),!0)},disable:function(t){return!!l[t]&&(l[t].disabled=!0,!0)},enable:function(t){return!!l[t]&&(l[t].disabled=!1,!0)},pause:function(){a=!0},resume:function(){a=!1},focus:function(e,n){var o=!1;void 0===n&&"boolean"==typeof e&&(n=e,e=void 0);var i=!a&&n;if(i&&D.pause(),e)if("string"==typeof e)o=l[e]?M(e):B(e);else{t&&e instanceof t&&(e=e.get(0));var r=P(e);x(e,r)&&(o=k(e,r))}else o=M();return i&&D.resume(),o},move:function(t,e){if(t=t.toLowerCase(),!o[t])return!1;var n=e?w(e)[0]:y();if(!n)return!1;var i=P(n);return!!i&&!!C(n,"willmove",{direction:t,sectionId:i,cause:"api"})&&L(t,n,i)},makeFocusable:function(t){var n=function(t){var n=void 0!==t.tabIndexIgnoreList?t.tabIndexIgnoreList:e.tabIndexIgnoreList;w(t.selector).forEach(function(t){v(t,n)||t.getAttribute("tabindex")||t.setAttribute("tabindex","-1")})};if(t){if(!l[t])throw new Error('Section "'+t+"\" doesn't exist!");n(l[t])}else for(var o in l)n(l[o])},setDefaultSection:function(t){if(t){if(!l[t])throw new Error('Section "'+t+"\" doesn't exist!");u=t}else u=""}};window.SpatialNavigation=D,"object"==typeof module&&(module.exports=D),t&&(t.SpatialNavigation=function(){if(D.init(),arguments.length>0){if(t.isPlainObject(arguments[0]))return D.add(arguments[0]);if("string"===t.type(arguments[0])&&t.isFunction(D[arguments[0]]))return D[arguments[0]].apply(D,[].slice.call(arguments,1))}return t.extend({},D)},t.fn.SpatialNavigation=function(){var e;return(e=t.isPlainObject(arguments[0])?arguments[0]:{id:arguments[0]}).selector=this,D.init(),e.id&&D.remove(e.id),D.add(e),D.makeFocusable(e.id),this})}(window.jQuery);